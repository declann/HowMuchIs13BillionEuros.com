import{NodeProp as P}from"../common@1.2.1/index.ec92ec4c.js";let L=0;class m{constructor(t,a,i,r){this.name=t,this.set=a,this.base=i,this.modified=r,this.id=L++}toString(){let{name:t}=this;for(let a of this.modified)a.name&&(t=`${a.name}(${t})`);return t}static define(t,a){let i=typeof t=="string"?t:"?";if(t instanceof m&&(a=t),a?.base)throw new Error("Can not derive from a modified tag");let r=new m(i,[],null,[]);if(r.set.push(r),a)for(let o of a.set)r.set.push(o);return r}static defineModifier(t){let a=new I(t);return i=>i.modified.indexOf(a)>-1?i:I.get(i.base||i,i.modified.concat(a).sort((r,o)=>r.id-o.id))}}let Q=0;class I{constructor(t){this.name=t,this.instances=[],this.id=Q++}static get(t,a){if(!a.length)return t;let i=a[0].instances.find(l=>l.base==t&&U(a,l.modified));if(i)return i;let r=[],o=new m(t.name,r,t,a);for(let l of a)l.instances.push(o);let g=W(a);for(let l of t.set)if(!l.modified.length)for(let d of g)r.push(I.get(l,d));return o}}function U(n,t){return n.length==t.length&&n.every((a,i)=>a==t[i])}function W(n){let t=[[]];for(let a=0;a<n.length;a++)for(let i=0,r=t.length;i<r;i++)t.push(t[i].concat(n[a]));return t.sort((a,i)=>i.length-a.length)}function X(n){let t=Object.create(null);for(let a in n){let i=n[a];Array.isArray(i)||(i=[i]);for(let r of a.split(" "))if(r){let o=[],g=2,l=r;for(let f=0;;){if(l=="..."&&f>0&&f+3==r.length){g=1;break}let h=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!h)throw new RangeError("Invalid path: "+r);if(o.push(h[0]=="*"?"":h[0][0]=='"'?JSON.parse(h[0]):h[0]),f+=h[0].length,f==r.length)break;let p=r[f++];if(f==r.length&&p=="!"){g=0;break}if(p!="/")throw new RangeError("Invalid path: "+r);l=r.slice(f)}let d=o.length-1,c=o[d];if(!c)throw new RangeError("Invalid path: "+r);let y=new A(i,g,d>0?o.slice(0,d):null);t[c]=y.sort(t[c])}}return V.add(t)}const V=new P;class A{constructor(t,a,i,r){this.tags=t,this.mode=a,this.context=i,this.next=r}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}A.empty=new A([],2,null);function $(n,t){let a=Object.create(null);for(let o of n)if(!Array.isArray(o.tag))a[o.tag.id]=o.class;else for(let g of o.tag)a[g.id]=o.class;let{scope:i,all:r=null}=t||{};return{style:o=>{let g=r;for(let l of o)for(let d of l.set){let c=a[d.id];if(c){g=g?g+" "+c:c;break}}return g},scope:i}}function Y(n,t){let a=null;for(let i of n){let r=i.style(t);r&&(a=a?a+" "+r:r)}return a}function z(n,t,a,i=0,r=n.length){let o=new _(i,Array.isArray(t)?t:[t],a);o.highlightRange(n.cursor(),i,r,"",o.highlighters),o.flush(r)}function Z(n,t,a,i,r,o=0,g=n.length){let l=o;function d(c,y){if(!(c<=l)){for(let f=n.slice(l,c),h=0;;){let p=f.indexOf(`
`,h),R=p<0?f.length:p;if(R>h&&i(f.slice(h,R),y),p<0)break;r(),h=p+1}l=c}}z(t,a,(c,y,f)=>{d(c,""),d(y,f)},o,g),d(g,"")}class _{constructor(t,a,i){this.at=t,this.highlighters=a,this.span=i,this.class=""}startSpan(t,a){a!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=a)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,a,i,r,o){let{type:g,from:l,to:d}=t;if(l>=i||d<=a)return;g.isTop&&(o=this.highlighters.filter(p=>!p.scope||p.scope(g)));let c=r,y=D(t)||A.empty,f=Y(o,y.tags);if(f&&(c&&(c+=" "),c+=f,y.mode==1&&(r+=(r?" ":"")+f)),this.startSpan(Math.max(a,l),c),y.opaque)return;let h=t.tree&&t.tree.prop(P.mounted);if(h&&h.overlay){let p=t.node.enter(h.overlay[0].from+l,1),R=this.highlighters.filter(v=>!v.scope||v.scope(h.tree.type)),B=t.firstChild();for(let v=0,M=l;;v++){let O=v<h.overlay.length?h.overlay[v]:null,K=O?O.from+l:d,J=Math.max(a,M),C=Math.min(i,K);if(J<C&&B)for(;t.from<C&&(this.highlightRange(t,J,C,r,o),this.startSpan(Math.min(C,t.to),c),!(t.to>=K||!t.nextSibling())););if(!O||K>i)break;M=O.to+l,M>a&&(this.highlightRange(p.cursor(),Math.max(a,O.from+l),Math.min(i,M),"",R),this.startSpan(Math.min(i,M),c))}B&&t.parent()}else if(t.firstChild()){h&&(r="");do if(!(t.to<=a)){if(t.from>=i)break;this.highlightRange(t,a,i,r,o),this.startSpan(Math.min(i,t.to),c)}while(t.nextSibling());t.parent()}}}function D(n){let t=n.type.prop(V);for(;t&&t.context&&!n.matchContext(t.context);)t=t.next;return t||null}const e=m.define,T=e(),N=e(),F=e(N),G=e(N),w=e(),q=e(w),j=e(w),u=e(),x=e(u),k=e(),b=e(),H=e(),S=e(H),E=e(),s={comment:T,lineComment:e(T),blockComment:e(T),docComment:e(T),name:N,variableName:e(N),typeName:F,tagName:e(F),propertyName:G,attributeName:e(G),className:e(N),labelName:e(N),namespace:e(N),macroName:e(N),literal:w,string:q,docString:e(q),character:e(q),attributeValue:e(q),number:j,integer:e(j),float:e(j),bool:e(w),regexp:e(w),escape:e(w),color:e(w),url:e(w),keyword:k,self:e(k),null:e(k),atom:e(k),unit:e(k),modifier:e(k),operatorKeyword:e(k),controlKeyword:e(k),definitionKeyword:e(k),moduleKeyword:e(k),operator:b,derefOperator:e(b),arithmeticOperator:e(b),logicOperator:e(b),bitwiseOperator:e(b),compareOperator:e(b),updateOperator:e(b),definitionOperator:e(b),typeOperator:e(b),controlOperator:e(b),punctuation:H,separator:e(H),bracket:S,angleBracket:e(S),squareBracket:e(S),paren:e(S),brace:e(S),content:u,heading:x,heading1:e(x),heading2:e(x),heading3:e(x),heading4:e(x),heading5:e(x),heading6:e(x),contentSeparator:e(u),list:e(u),quote:e(u),emphasis:e(u),strong:e(u),link:e(u),monospace:e(u),strikethrough:e(u),inserted:e(),deleted:e(),changed:e(),invalid:e(),meta:E,documentMeta:e(E),annotation:e(E),processingInstruction:e(E),definition:m.defineModifier("definition"),constant:m.defineModifier("constant"),function:m.defineModifier("function"),standard:m.defineModifier("standard"),local:m.defineModifier("local"),special:m.defineModifier("special")};for(let n in s){let t=s[n];t instanceof m&&(t.name=n)}const tt=$([{tag:s.link,class:"tok-link"},{tag:s.heading,class:"tok-heading"},{tag:s.emphasis,class:"tok-emphasis"},{tag:s.strong,class:"tok-strong"},{tag:s.keyword,class:"tok-keyword"},{tag:s.atom,class:"tok-atom"},{tag:s.bool,class:"tok-bool"},{tag:s.url,class:"tok-url"},{tag:s.labelName,class:"tok-labelName"},{tag:s.inserted,class:"tok-inserted"},{tag:s.deleted,class:"tok-deleted"},{tag:s.literal,class:"tok-literal"},{tag:s.string,class:"tok-string"},{tag:s.number,class:"tok-number"},{tag:[s.regexp,s.escape,s.special(s.string)],class:"tok-string2"},{tag:s.variableName,class:"tok-variableName"},{tag:s.local(s.variableName),class:"tok-variableName tok-local"},{tag:s.definition(s.variableName),class:"tok-variableName tok-definition"},{tag:s.special(s.variableName),class:"tok-variableName2"},{tag:s.definition(s.propertyName),class:"tok-propertyName tok-definition"},{tag:s.typeName,class:"tok-typeName"},{tag:s.namespace,class:"tok-namespace"},{tag:s.className,class:"tok-className"},{tag:s.macroName,class:"tok-macroName"},{tag:s.propertyName,class:"tok-propertyName"},{tag:s.operator,class:"tok-operator"},{tag:s.comment,class:"tok-comment"},{tag:s.meta,class:"tok-meta"},{tag:s.invalid,class:"tok-invalid"},{tag:s.punctuation,class:"tok-punctuation"}]);export{m as Tag,tt as classHighlighter,D as getStyleTags,Z as highlightCode,z as highlightTree,X as styleTags,$ as tagHighlighter,s as tags};
