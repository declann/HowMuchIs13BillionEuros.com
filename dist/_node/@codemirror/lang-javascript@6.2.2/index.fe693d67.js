import{parser as M}from"../../@lezer/javascript@1.4.17/index.a8beda5d.js";import{LRLanguage as R,indentNodeProp as _,continuedIndent as S,flatIndent as Z,delimitedIndent as z,foldNodeProp as H,foldInside as W,defineLanguageFacet as q,sublanguageProp as C,syntaxTree as $,LanguageSupport as G}from"../language@6.10.2/index.372ccf5f.js";import{EditorSelection as K}from"../state@6.4.1/index.66d24d9c.js";import{EditorView as Q}from"../view@6.33.0/index.836a6482.js";import{snippetCompletion as c,ifNotIn as U,completeFromList as Y}from"../autocomplete@6.18.0/index.0467ca2b.js";import{NodeWeakMap as ee,IterMode as te}from"../../@lezer/common@1.2.1/index.ec92ec4c.js";const x=[c("function ${name}(${params}) {\n	${}\n}",{label:"function",detail:"definition",type:"keyword"}),c("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n	${}\n}",{label:"for",detail:"loop",type:"keyword"}),c("for (let ${name} of ${collection}) {\n	${}\n}",{label:"for",detail:"of loop",type:"keyword"}),c("do {\n	${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),c("while (${}) {\n	${}\n}",{label:"while",detail:"loop",type:"keyword"}),c(`try {
	\${}
} catch (\${error}) {
	\${}
}`,{label:"try",detail:"/ catch block",type:"keyword"}),c("if (${}) {\n	${}\n}",{label:"if",detail:"block",type:"keyword"}),c(`if (\${}) {
	\${}
} else {
	\${}
}`,{label:"if",detail:"/ else block",type:"keyword"}),c(`class \${name} {
	constructor(\${params}) {
		\${}
	}
}`,{label:"class",detail:"definition",type:"keyword"}),c('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),c('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],T=x.concat([c("interface ${name} {\n	${}\n}",{label:"interface",detail:"definition",type:"keyword"}),c("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),c("enum ${name} {\n	${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),I=new ee,J=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function y(e){return(n,o)=>{let t=n.node.getChild("VariableDefinition");return t&&o(t,e),!0}}const ne=["FunctionDeclaration"],oe={FunctionDeclaration:y("function"),ClassDeclaration:y("class"),ClassExpression:()=>!0,EnumDeclaration:y("constant"),TypeAliasDeclaration:y("type"),NamespaceDeclaration:y("namespace"),VariableDefinition(e,n){e.matchContext(ne)||n(e,"variable")},TypeDefinition(e,n){n(e,"type")},__proto__:null};function X(e,n){let o=I.get(n);if(o)return o;let t=[],a=!0;function i(r,l){let p=e.sliceString(r.from,r.to);t.push({label:p,type:l})}return n.cursor(te.IncludeAnonymous).iterate(r=>{if(a)a=!1;else if(r.name){let l=oe[r.name];if(l&&l(r,i)||J.has(r.name))return!1}else if(r.to-r.from>8192){for(let l of X(e,r.node))t.push(l);return!1}}),I.set(n,t),t}const b=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,w=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName",".","?."];function D(e){let n=$(e.state).resolveInner(e.pos,-1);if(w.indexOf(n.name)>-1)return null;let o=n.name=="VariableName"||n.to-n.from<20&&b.test(e.state.sliceDoc(n.from,n.to));if(!o&&!e.explicit)return null;let t=[];for(let a=n;a;a=a.parent)J.has(a.name)&&(t=t.concat(X(e.state.doc,a)));return{options:t,from:o?n.from:e.pos,validFor:b}}function k(e,n,o){var t;let a=[];for(;;){let i=n.firstChild,r;if(i?.name=="VariableName")return a.push(e(i)),{path:a.reverse(),name:o};if(i?.name=="MemberExpression"&&((t=r=i.lastChild)===null||t===void 0?void 0:t.name)=="PropertyName")a.push(e(r)),n=i;else return null}}function E(e){let n=t=>e.state.doc.sliceString(t.from,t.to),o=$(e.state).resolveInner(e.pos,-1);return o.name=="PropertyName"?k(n,o.parent,n(o)):(o.name=="."||o.name=="?.")&&o.parent.name=="MemberExpression"?k(n,o.parent,""):w.indexOf(o.name)>-1?null:o.name=="VariableName"||o.to-o.from<20&&b.test(n(o))?{path:[],name:n(o)}:o.name=="MemberExpression"?k(n,o,""):e.explicit?{path:[],name:""}:null}function re(e,n){let o=[],t=new Set;for(let a=0;;a++){for(let r of(Object.getOwnPropertyNames||Object.keys)(e)){if(!/^[a-zA-Z_$\xaa-\uffdc][\w$\xaa-\uffdc]*$/.test(r)||t.has(r))continue;t.add(r);let l;try{l=e[r]}catch{continue}o.push({label:r,type:typeof l=="function"?/^[A-Z]/.test(r)?"class":n?"function":"method":n?"variable":"property",boost:-a})}let i=Object.getPrototypeOf(e);if(!i)return o;e=i}}function ae(e){let n=new Map;return o=>{let t=E(o);if(!t)return null;let a=e;for(let r of t.path)if(a=a[r],!a)return null;let i=n.get(a);return i||n.set(a,i=re(a,!t.path.length)),{from:o.pos-t.name.length,options:i,validFor:b}}}const m=R.define({name:"javascript",parser:M.configure({props:[_.add({IfStatement:S({except:/^\s*({|else\b)/}),TryStatement:S({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:Z,SwitchBody:e=>{let n=e.textAfter,o=/^\s*\}/.test(n),t=/^\s*(case|default)\b/.test(n);return e.baseIndent+(o?0:t?1:2)*e.unit},Block:z({closing:"}"}),ArrowFunction:e=>e.baseIndent+e.unit,"TemplateString BlockComment":()=>null,"Statement Property":S({except:/^{/}),JSXElement(e){let n=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(n?0:e.unit)},JSXEscape(e){let n=/\s*\}/.test(e.textAfter);return e.lineIndent(e.node.from)+(n?0:e.unit)},"JSXOpenTag JSXSelfClosingTag"(e){return e.column(e.node.from)+e.unit}}),H.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":W,BlockComment(e){return{from:e.from+2,to:e.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),A={test:e=>/^JSX/.test(e.name),facet:q({commentTokens:{block:{open:"{/*",close:"*/}"}}})},L=m.configure({dialect:"ts"},"typescript"),N=m.configure({dialect:"jsx",props:[C.add(e=>e.isTop?[A]:void 0)]}),O=m.configure({dialect:"jsx ts",props:[C.add(e=>e.isTop?[A]:void 0)]},"typescript");let P=e=>({label:e,type:"keyword"});const j="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(P),ie=j.concat(["declare","implements","private","protected","public"].map(P));function le(e={}){let n=e.jsx?e.typescript?O:N:e.typescript?L:m,o=e.typescript?T.concat(ie):x.concat(j);return new G(n,[m.data.of({autocomplete:U(w,Y(o))}),m.data.of({autocomplete:D}),e.jsx?B:[]])}function se(e){for(;;){if(e.name=="JSXOpenTag"||e.name=="JSXSelfClosingTag"||e.name=="JSXFragmentTag")return e;if(e.name=="JSXEscape"||!e.parent)return null;e=e.parent}}function F(e,n,o=e.length){for(let t=n?.firstChild;t;t=t.nextSibling)if(t.name=="JSXIdentifier"||t.name=="JSXBuiltin"||t.name=="JSXNamespacedName"||t.name=="JSXMemberExpression")return e.sliceString(t.from,Math.min(t.to,o));return""}const ce=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),B=Q.inputHandler.of((e,n,o,t,a)=>{if((ce?e.composing:e.compositionStarted)||e.state.readOnly||n!=o||t!=">"&&t!="/"||!m.isActiveAt(e.state,n,-1))return!1;let i=a(),{state:r}=i,l=r.changeByRange(p=>{var u;let{head:s}=p,f=$(r).resolveInner(s-1,-1),g;if(f.name=="JSXStartTag"&&(f=f.parent),!(r.doc.sliceString(s-1,s)!=t||f.name=="JSXAttributeValue"&&f.to>s)){if(t==">"&&f.name=="JSXFragmentTag")return{range:p,changes:{from:s,insert:"</>"}};if(t=="/"&&f.name=="JSXStartCloseTag"){let d=f.parent,h=d.parent;if(h&&d.from==s-2&&((g=F(r.doc,h.firstChild,s))||((u=h.firstChild)===null||u===void 0?void 0:u.name)=="JSXFragmentTag")){let v=`${g}>`;return{range:K.cursor(s+v.length,-1),changes:{from:s,insert:v}}}}else if(t==">"){let d=se(f);if(d&&d.name=="JSXOpenTag"&&!/^\/?>|^<\//.test(r.doc.sliceString(s,s+2))&&(g=F(r.doc,d,s)))return{range:p,changes:{from:s,insert:`</${g}>`}}}}return{range:p}});return l.changes.empty?!1:(e.dispatch([i,r.update(l,{userEvent:"input.complete",scrollIntoView:!0})]),!0)});function pe(e,n){return n||(n={parserOptions:{ecmaVersion:2019,sourceType:"module"},env:{browser:!0,node:!0,es6:!0,es2015:!0,es2017:!0,es2020:!0},rules:{}},e.getRules().forEach((o,t)=>{o.meta.docs.recommended&&(n.rules[t]=2)})),o=>{let{state:t}=o,a=[];for(let{from:i,to:r}of m.findRegions(t)){let l=t.doc.lineAt(i),p={line:l.number-1,col:i-l.from,pos:i};for(let u of e.verify(t.sliceDoc(i,r),n))a.push(fe(u,t.doc,p))}return a}}function V(e,n,o,t){return o.line(e+t.line).from+n+(e==1?t.col-1:-1)}function fe(e,n,o){let t=V(e.line,e.column,n,o),a={from:t,to:e.endLine!=null&&e.endColumn!=1?V(e.endLine,e.endColumn,n,o):t,message:e.message,source:e.ruleId?"eslint:"+e.ruleId:"eslint",severity:e.severity==1?"warning":"error"};if(e.fix){let{range:i,text:r}=e.fix,l=i[0]+o.pos-t,p=i[1]+o.pos-t;a.actions=[{name:"fix",apply(u,s){u.dispatch({changes:{from:s+l,to:s+p,insert:r},scrollIntoView:!0})}}]}return a}export{B as autoCloseTags,E as completionPath,pe as esLint,le as javascript,m as javascriptLanguage,N as jsxLanguage,D as localCompletionSource,ae as scopeCompletionSource,x as snippets,O as tsxLanguage,L as typescriptLanguage,T as typescriptSnippets};
