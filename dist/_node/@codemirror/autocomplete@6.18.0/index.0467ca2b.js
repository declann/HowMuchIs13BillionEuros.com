import{Annotation as Qt,StateEffect as k,Facet as ct,combineConfig as Xt,StateField as X,Prec as Y,MapMode as G,RangeValue as Yt,RangeSet as Gt,codePointSize as O,codePointAt as C,EditorSelection as x,CharCategory as J,Text as Jt,Transaction as Zt,fromCodePoint as pt}from"../state@6.4.1/index.66d24d9c.js";import{Direction as _t,showTooltip as te,EditorView as E,ViewPlugin as ee,logException as Z,getTooltip as ht,Decoration as U,WidgetType as ne,keymap as ft}from"../view@6.33.0/index.836a6482.js";import{syntaxTree as M,indentUnit as oe}from"../language@6.10.2/index.372ccf5f.js";class _{constructor(t,e,o,s){this.state=t,this.pos=e,this.explicit=o,this.view=s,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(t){let e=M(this.state).resolveInner(this.pos,-1);for(;e&&t.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(t){let e=this.state.doc.lineAt(this.pos),o=Math.max(e.from,this.pos-250),s=e.text.slice(o-e.from,this.pos-e.from),i=s.search(gt(t,!1));return i<0?null:{from:o+i,to:this.pos,text:s.slice(i)}}get aborted(){return this.abortListeners==null}addEventListener(t,e,o){t=="abort"&&this.abortListeners&&(this.abortListeners.push(e),o&&o.onDocChange&&(this.abortOnDocChange=!0))}}function ut(n){let t=Object.keys(n).join(""),e=/\w/.test(t);return e&&(t=t.replace(/\w/g,"")),`[${e?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function se(n){let t=Object.create(null),e=Object.create(null);for(let{label:s}of n){t[s[0]]=!0;for(let i=1;i<s.length;i++)e[s[i]]=!0}let o=ut(t)+ut(e)+"*$";return[new RegExp("^"+o),new RegExp(o)]}function dt(n){let t=n.map(s=>typeof s=="string"?{label:s}:s),[e,o]=t.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:se(t);return s=>{let i=s.matchBefore(o);return i||s.explicit?{from:i?i.from:s.pos,options:t,validFor:e}:null}}function ie(n,t){return e=>{for(let o=M(e.state).resolveInner(e.pos,-1);o;o=o.parent){if(n.indexOf(o.name)>-1)return t(e);if(o.type.isTop)break}return null}}function le(n,t){return e=>{for(let o=M(e.state).resolveInner(e.pos,-1);o;o=o.parent){if(n.indexOf(o.name)>-1)return null;if(o.type.isTop)break}return t(e)}}class mt{constructor(t,e,o,s){this.completion=t,this.source=e,this.match=o,this.score=s}}function S(n){return n.selection.main.from}function gt(n,t){var e;let{source:o}=n,s=t&&o[0]!="^",i=o[o.length-1]!="$";return!s&&!i?n:new RegExp(`${s?"^":""}(?:${o})${i?"$":""}`,(e=n.flags)!==null&&e!==void 0?e:n.ignoreCase?"i":"")}const q=Qt.define();function vt(n,t,e,o){let{main:s}=n.selection,i=e-s.from,l=o-s.from;return Object.assign(Object.assign({},n.changeByRange(r=>r!=s&&e!=o&&n.sliceDoc(r.from+i,r.from+l)!=n.sliceDoc(e,o)?{range:r}:{changes:{from:r.from+i,to:o==s.from?r.to:r.from+l,insert:t},range:x.cursor(r.from+i+t.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}const bt=new WeakMap;function re(n){if(!Array.isArray(n))return n;let t=bt.get(n);return t||bt.set(n,t=dt(n)),t}const V=k.define(),F=k.define();class ae{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let e=0;e<t.length;){let o=C(t,e),s=O(o);this.chars.push(o);let i=t.slice(e,e+s),l=i.toUpperCase();this.folded.push(C(l==i?i.toLowerCase():l,0)),e+=s}this.astral=t.length!=this.chars.length}ret(t,e){return this.score=t,this.matched=e,this}match(t){if(this.pattern.length==0)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:e,folded:o,any:s,precise:i,byWord:l}=this;if(e.length==1){let d=C(t,0),D=O(d),I=D==t.length?0:-100;if(d!=e[0])if(d==o[0])I+=-200;else return null;return this.ret(I,[0,D])}let r=t.indexOf(this.pattern);if(r==0)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=e.length,c=0;if(r<0){for(let d=0,D=Math.min(t.length,200);d<D&&c<a;){let I=C(t,d);(I==e[c]||I==o[c])&&(s[c++]=d),d+=O(I)}if(c<a)return null}let p=0,h=0,f=!1,u=0,g=-1,w=-1,z=/[a-z]/.test(t),B=!0;for(let d=0,D=Math.min(t.length,200),I=0;d<D&&h<a;){let b=C(t,d);r<0&&(p<a&&b==e[p]&&(i[p++]=d),u<a&&(b==e[u]||b==o[u]?(u==0&&(g=d),w=d+1,u++):u=0));let W,Q=b<255?b>=48&&b<=57||b>=97&&b<=122?2:b>=65&&b<=90?1:0:(W=pt(b))!=W.toLowerCase()?1:W!=W.toUpperCase()?2:0;(!d||Q==1&&z||I==0&&Q!=0)&&(e[h]==b||o[h]==b&&(f=!0)?l[h++]=d:l.length&&(B=!1)),I=Q,d+=O(b)}return h==a&&l[0]==0&&B?this.result(-100+(f?-200:0),l,t):u==a&&g==0?this.ret(-200-t.length+(w==t.length?0:-100),[0,w]):r>-1?this.ret(-700-t.length,[r,r+this.pattern.length]):u==a?this.ret(-900-t.length,[g,w]):h==a?this.result(-100+(f?-200:0)+-700+(B?0:-1100),l,t):e.length==2?null:this.result((s[0]?-700:0)+-200+-1100,s,t)}result(t,e,o){let s=[],i=0;for(let l of e){let r=l+(this.astral?O(C(o,l)):1);i&&s[i-1]==l?s[i-1]=r:(s[i++]=l,s[i++]=r)}return this.ret(t-o.length,s)}}class ce{constructor(t){this.pattern=t,this.matched=[],this.score=0,this.folded=t.toLowerCase()}match(t){if(t.length<this.pattern.length)return null;let e=t.slice(0,this.pattern.length),o=e==this.pattern?0:e.toLowerCase()==this.folded?-200:null;return o==null?null:(this.matched=[0,e.length],this.score=o+(t.length==this.pattern.length?0:-100),this)}}const v=ct.define({combine(n){return Xt(n,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:pe,filterStrict:!1,compareCompletions:(t,e)=>t.label.localeCompare(e.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(t,e)=>t&&e,closeOnBlur:(t,e)=>t&&e,icons:(t,e)=>t&&e,tooltipClass:(t,e)=>o=>wt(t(o),e(o)),optionClass:(t,e)=>o=>wt(t(o),e(o)),addToOptions:(t,e)=>t.concat(e),filterStrict:(t,e)=>t||e})}});function wt(n,t){return n?t?n+" "+t:n:t}function pe(n,t,e,o,s,i){let l=n.textDirection==_t.RTL,r=l,a=!1,c="top",p,h,f=t.left-s.left,u=s.right-t.right,g=o.right-o.left,w=o.bottom-o.top;if(r&&f<Math.min(g,u)?r=!1:!r&&u<Math.min(g,f)&&(r=!0),g<=(r?f:u))p=Math.max(s.top,Math.min(e.top,s.bottom-w))-t.top,h=Math.min(400,r?f:u);else{a=!0,h=Math.min(400,(l?t.right:s.right-t.left)-30);let d=s.bottom-t.bottom;d>=w||d>t.top?p=e.bottom-t.top:(c="bottom",p=t.bottom-e.top)}let z=(t.bottom-t.top)/i.offsetHeight,B=(t.right-t.left)/i.offsetWidth;return{style:`${c}: ${p/z}px; max-width: ${h/B}px`,class:"cm-completionInfo-"+(a?l?"left-narrow":"right-narrow":r?"left":"right")}}function he(n){let t=n.addToOptions.slice();return n.icons&&t.push({render(e){let o=document.createElement("div");return o.classList.add("cm-completionIcon"),e.type&&o.classList.add(...e.type.split(/\s+/g).map(s=>"cm-completionIcon-"+s)),o.setAttribute("aria-hidden","true"),o},position:20}),t.push({render(e,o,s,i){let l=document.createElement("span");l.className="cm-completionLabel";let r=e.displayLabel||e.label,a=0;for(let c=0;c<i.length;){let p=i[c++],h=i[c++];p>a&&l.appendChild(document.createTextNode(r.slice(a,p)));let f=l.appendChild(document.createElement("span"));f.appendChild(document.createTextNode(r.slice(p,h))),f.className="cm-completionMatchedText",a=h}return a<r.length&&l.appendChild(document.createTextNode(r.slice(a))),l},position:50},{render(e){if(!e.detail)return null;let o=document.createElement("span");return o.className="cm-completionDetail",o.textContent=e.detail,o},position:80}),t.sort((e,o)=>e.position-o.position).map(e=>e.render)}function tt(n,t,e){if(n<=e)return{from:0,to:n};if(t<0&&(t=0),t<=n>>1){let s=Math.floor(t/e);return{from:s*e,to:(s+1)*e}}let o=Math.floor((n-t)/e);return{from:n-(o+1)*e,to:n-o*e}}class fe{constructor(t,e,o){this.view=t,this.stateField=e,this.applyCompletion=o,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let s=t.state.field(e),{options:i,selected:l}=s.open,r=t.state.facet(v);this.optionContent=he(r),this.optionClass=r.optionClass,this.tooltipClass=r.tooltipClass,this.range=tt(i.length,l,r.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(t.state),this.dom.addEventListener("mousedown",a=>{let{options:c}=t.state.field(e).open;for(let p=a.target,h;p&&p!=this.dom;p=p.parentNode)if(p.nodeName=="LI"&&(h=/-(\d+)$/.exec(p.id))&&+h[1]<c.length){this.applyCompletion(t,c[+h[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let c=t.state.field(this.stateField,!1);c&&c.tooltip&&t.state.facet(v).closeOnBlur&&a.relatedTarget!=t.contentDOM&&t.dispatch({effects:F.of(null)})}),this.showOptions(i,s.id)}mount(){this.updateSel()}showOptions(t,e){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t,e,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(t){var e;let o=t.state.field(this.stateField),s=t.startState.field(this.stateField);if(this.updateTooltipClass(t.state),o!=s){let{options:i,selected:l,disabled:r}=o.open;(!s.open||s.open.options!=i)&&(this.range=tt(i.length,l,t.state.facet(v).maxRenderedOptions),this.showOptions(i,o.id)),this.updateSel(),r!=((e=s.open)===null||e===void 0?void 0:e.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!r)}}updateTooltipClass(t){let e=this.tooltipClass(t);if(e!=this.currentClass){for(let o of this.currentClass.split(" "))o&&this.dom.classList.remove(o);for(let o of e.split(" "))o&&this.dom.classList.add(o);this.currentClass=e}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let t=this.view.state.field(this.stateField),e=t.open;if((e.selected>-1&&e.selected<this.range.from||e.selected>=this.range.to)&&(this.range=tt(e.options.length,e.selected,this.view.state.facet(v).maxRenderedOptions),this.showOptions(e.options,t.id)),this.updateSelectedOption(e.selected)){this.destroyInfo();let{completion:o}=e.options[e.selected],{info:s}=o;if(!s)return;let i=typeof s=="string"?document.createTextNode(s):s(o);if(!i)return;"then"in i?i.then(l=>{l&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(l,o)}).catch(l=>Z(this.view.state,l,"completion info")):this.addInfoPane(i,o)}}addInfoPane(t,e){this.destroyInfo();let o=this.info=document.createElement("div");if(o.className="cm-tooltip cm-completionInfo",t.nodeType!=null)o.appendChild(t),this.infoDestroy=null;else{let{dom:s,destroy:i}=t;o.appendChild(s),this.infoDestroy=i||null}this.dom.appendChild(o),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(t){let e=null;for(let o=this.list.firstChild,s=this.range.from;o;o=o.nextSibling,s++)o.nodeName!="LI"||!o.id?s--:s==t?o.hasAttribute("aria-selected")||(o.setAttribute("aria-selected","true"),e=o):o.hasAttribute("aria-selected")&&o.removeAttribute("aria-selected");return e&&de(this.list,e),e}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let e=this.dom.getBoundingClientRect(),o=this.info.getBoundingClientRect(),s=t.getBoundingClientRect(),i=this.space;if(!i){let l=this.dom.ownerDocument.defaultView||window;i={left:0,top:0,right:l.innerWidth,bottom:l.innerHeight}}return s.top>Math.min(i.bottom,e.bottom)-10||s.bottom<Math.max(i.top,e.top)+10?null:this.view.state.facet(v).positionInfo(this.view,e,s,o,i,this.dom)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(t,e,o){const s=document.createElement("ul");s.id=e,s.setAttribute("role","listbox"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-label",this.view.state.phrase("Completions"));let i=null;for(let l=o.from;l<o.to;l++){let{completion:r,match:a}=t[l],{section:c}=r;if(c){let f=typeof c=="string"?c:c.name;if(f!=i&&(l>o.from||o.from==0))if(i=f,typeof c!="string"&&c.header)s.appendChild(c.header(c));else{let u=s.appendChild(document.createElement("completion-section"));u.textContent=f}}const p=s.appendChild(document.createElement("li"));p.id=e+"-"+l,p.setAttribute("role","option");let h=this.optionClass(r);h&&(p.className=h);for(let f of this.optionContent){let u=f(r,this.view.state,this.view,a);u&&p.appendChild(u)}}return o.from&&s.classList.add("cm-completionListIncompleteTop"),o.to<t.length&&s.classList.add("cm-completionListIncompleteBottom"),s}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function ue(n,t){return e=>new fe(e,n,t)}function de(n,t){let e=n.getBoundingClientRect(),o=t.getBoundingClientRect(),s=e.height/n.offsetHeight;o.top<e.top?n.scrollTop-=(e.top-o.top)/s:o.bottom>e.bottom&&(n.scrollTop+=(o.bottom-e.bottom)/s)}function yt(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function me(n,t){let e=[],o=null,s=c=>{e.push(c);let{section:p}=c.completion;if(p){o||(o=[]);let h=typeof p=="string"?p:p.name;o.some(f=>f.name==h)||o.push(typeof p=="string"?{name:h}:p)}},i=t.facet(v);for(let c of n)if(c.hasResult()){let p=c.result.getMatch;if(c.result.filter===!1)for(let h of c.result.options)s(new mt(h,c.source,p?p(h):[],1e9-e.length));else{let h=t.sliceDoc(c.from,c.to),f,u=i.filterStrict?new ce(h):new ae(h);for(let g of c.result.options)if(f=u.match(g.label)){let w=g.displayLabel?p?p(g,f.matched):[]:f.matched;s(new mt(g,c.source,w,f.score+(g.boost||0)))}}}if(o){let c=Object.create(null),p=0,h=(f,u)=>{var g,w;return((g=f.rank)!==null&&g!==void 0?g:1e9)-((w=u.rank)!==null&&w!==void 0?w:1e9)||(f.name<u.name?-1:1)};for(let f of o.sort(h))p-=1e5,c[f.name]=p;for(let f of e){let{section:u}=f.completion;u&&(f.score+=c[typeof u=="string"?u:u.name])}}let l=[],r=null,a=i.compareCompletions;for(let c of e.sort((p,h)=>h.score-p.score||a(p.completion,h.completion))){let p=c.completion;!r||r.label!=p.label||r.detail!=p.detail||r.type!=null&&p.type!=null&&r.type!=p.type||r.apply!=p.apply||r.boost!=p.boost?l.push(c):yt(c.completion)>yt(r)&&(l[l.length-1]=c),r=c.completion}return l}class P{constructor(t,e,o,s,i,l){this.options=t,this.attrs=e,this.tooltip=o,this.timestamp=s,this.selected=i,this.disabled=l}setSelected(t,e){return t==this.selected||t>=this.options.length?this:new P(this.options,xt(e,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,e,o,s,i){let l=me(t,e);if(!l.length)return s&&t.some(a=>a.state==1)?new P(s.options,s.attrs,s.tooltip,s.timestamp,s.selected,!0):null;let r=e.facet(v).selectOnOpen?0:-1;if(s&&s.selected!=r&&s.selected!=-1){let a=s.options[s.selected].completion;for(let c=0;c<l.length;c++)if(l[c].completion==a){r=c;break}}return new P(l,xt(o,r),{pos:t.reduce((a,c)=>c.hasResult()?Math.min(a,c.from):a,1e8),create:xe,above:i.aboveCursor},s?s.timestamp:Date.now(),r,!1)}map(t){return new P(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class K{constructor(t,e,o){this.active=t,this.id=e,this.open=o}static start(){return new K(we,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:e}=t,o=e.facet(v),s=(o.override||e.languageDataAt("autocomplete",S(e)).map(re)).map(l=>(this.active.find(r=>r.source==l)||new y(l,this.active.some(r=>r.state!=0)?1:0)).update(t,o));s.length==this.active.length&&s.every((l,r)=>l==this.active[r])&&(s=this.active);let i=this.open;i&&t.docChanged&&(i=i.map(t.changes)),t.selection||s.some(l=>l.hasResult()&&t.changes.touchesRange(l.from,l.to))||!ge(s,this.active)?i=P.build(s,e,this.id,i,o):i&&i.disabled&&!s.some(l=>l.state==1)&&(i=null),!i&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new y(l.source,0):l));for(let l of t.effects)l.is(et)&&(i=i&&i.setSelected(l.value,this.id));return s==this.active&&i==this.open?this:new K(s,this.id,i)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?ve:be}}function ge(n,t){if(n==t)return!0;for(let e=0,o=0;;){for(;e<n.length&&!n[e].hasResult;)e++;for(;o<t.length&&!t[o].hasResult;)o++;let s=e==n.length,i=o==t.length;if(s||i)return s==i;if(n[e++].result!=t[o++].result)return!1}}const ve={"aria-autocomplete":"list"},be={};function xt(n,t){let e={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":n};return t>-1&&(e["aria-activedescendant"]=n+"-"+t),e}const we=[];function Ct(n,t){if(n.isUserEvent("input.complete")){let o=n.annotation(q);if(o&&t.activateOnCompletion(o))return 12}let e=n.isUserEvent("input.type");return e&&t.activateOnTyping?5:e?1:n.isUserEvent("delete.backward")?2:n.selection?8:n.docChanged?16:0}class y{constructor(t,e,o=-1){this.source=t,this.state=e,this.explicitPos=o}hasResult(){return!1}update(t,e){let o=Ct(t,e),s=this;(o&8||o&16&&this.touches(t))&&(s=new y(s.source,0)),o&4&&s.state==0&&(s=new y(this.source,1)),s=s.updateFor(t,o);for(let i of t.effects)if(i.is(V))s=new y(s.source,1,i.value?S(t.state):-1);else if(i.is(F))s=new y(s.source,0);else if(i.is(It))for(let l of i.value)l.source==s.source&&(s=l);return s}updateFor(t,e){return this.map(t.changes)}map(t){return t.empty||this.explicitPos<0?this:new y(this.source,this.state,t.mapPos(this.explicitPos))}touches(t){return t.changes.touchesRange(S(t.state))}}class L extends y{constructor(t,e,o,s,i){super(t,2,e),this.result=o,this.from=s,this.to=i}hasResult(){return!0}updateFor(t,e){var o;if(!(e&3))return this.map(t.changes);let s=this.result;s.map&&!t.changes.empty&&(s=s.map(s,t.changes));let i=t.changes.mapPos(this.from),l=t.changes.mapPos(this.to,1),r=S(t.state);if((this.explicitPos<0?r<=i:r<this.from)||r>l||!s||e&2&&S(t.startState)==this.from)return new y(this.source,e&4?1:0);let a=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);return ye(s.validFor,t.state,i,l)?new L(this.source,a,s,i,l):s.update&&(s=s.update(s,i,l,new _(t.state,r,a>=0)))?new L(this.source,a,s,s.from,(o=s.to)!==null&&o!==void 0?o:S(t.state)):new y(this.source,1,a)}map(t){return t.empty?this:(this.result.map?this.result.map(this.result,t):this.result)?new L(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1)):new y(this.source,0)}touches(t){return t.changes.touchesRange(this.from,this.to)}}function ye(n,t,e,o){if(!n)return!1;let s=t.sliceDoc(e,o);return typeof n=="function"?n(s,e,o,t):gt(n,!0).test(s)}const It=k.define({map(n,t){return n.map(e=>e.map(t))}}),et=k.define(),m=X.define({create(){return K.start()},update(n,t){return n.update(t)},provide:n=>[te.from(n,t=>t.tooltip),E.contentAttributes.from(n,t=>t.attrs)]});function nt(n,t){const e=t.completion.apply||t.completion.label;let o=n.state.field(m).active.find(s=>s.source==t.source);return o instanceof L?(typeof e=="string"?n.dispatch(Object.assign(Object.assign({},vt(n.state,e,o.from,o.to)),{annotations:q.of(t.completion)})):e(n,t.completion,o.from,o.to),!0):!1}const xe=ue(m,nt);function $(n,t="option"){return e=>{let o=e.state.field(m,!1);if(!o||!o.open||o.open.disabled||Date.now()-o.open.timestamp<e.state.facet(v).interactionDelay)return!1;let s=1,i;t=="page"&&(i=ht(e,o.open.tooltip))&&(s=Math.max(2,Math.floor(i.dom.offsetHeight/i.dom.querySelector("li").offsetHeight)-1));let{length:l}=o.open.options,r=o.open.selected>-1?o.open.selected+s*(n?1:-1):n?0:l-1;return r<0?r=t=="page"?0:l-1:r>=l&&(r=t=="page"?l-1:0),e.dispatch({effects:et.of(r)}),!0}}const kt=n=>{let t=n.state.field(m,!1);return n.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<n.state.facet(v).interactionDelay?!1:nt(n,t.open.options[t.open.selected])},Ot=n=>n.state.field(m,!1)?(n.dispatch({effects:V.of(!0)}),!0):!1,St=n=>{let t=n.state.field(m,!1);return!t||!t.active.some(e=>e.state!=0)?!1:(n.dispatch({effects:F.of(null)}),!0)};class Ce{constructor(t,e){this.active=t,this.context=e,this.time=Date.now(),this.updates=[],this.done=void 0}}const Ie=50,ke=1e3,Oe=ee.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of n.state.field(m).active)t.state==1&&this.startQuery(t)}update(n){let t=n.state.field(m),e=n.state.facet(v);if(!n.selectionSet&&!n.docChanged&&n.startState.field(m)==t)return;let o=n.transactions.some(i=>{let l=Ct(i,e);return l&8||(i.selection||i.docChanged)&&!(l&3)});for(let i=0;i<this.running.length;i++){let l=this.running[i];if(o||l.context.abortOnDocChange&&n.docChanged||l.updates.length+n.transactions.length>Ie&&Date.now()-l.time>ke){for(let r of l.context.abortListeners)try{r()}catch(a){Z(this.view.state,a)}l.context.abortListeners=null,this.running.splice(i--,1)}else l.updates.push(...n.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),n.transactions.some(i=>i.effects.some(l=>l.is(V)))&&(this.pendingStart=!0);let s=this.pendingStart?50:e.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(i=>i.state==1&&!this.running.some(l=>l.active.source==i.source))?setTimeout(()=>this.startUpdate(),s):-1,this.composing!=0)for(let i of n.transactions)i.isUserEvent("input.type")?this.composing=2:this.composing==2&&i.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:n}=this.view,t=n.field(m);for(let e of t.active)e.state==1&&!this.running.some(o=>o.active.source==e.source)&&this.startQuery(e)}startQuery(n){let{state:t}=this.view,e=S(t),o=new _(t,e,n.explicitPos==e,this.view),s=new Ce(n,o);this.running.push(s),Promise.resolve(n.source(o)).then(i=>{s.context.aborted||(s.done=i||null,this.scheduleAccept())},i=>{this.view.dispatch({effects:F.of(null)}),Z(this.view.state,i)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(v).updateSyncTime))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],e=this.view.state.facet(v);for(let o=0;o<this.running.length;o++){let s=this.running[o];if(s.done===void 0)continue;if(this.running.splice(o--,1),s.done){let l=new L(s.active.source,s.active.explicitPos,s.done,s.done.from,(n=s.done.to)!==null&&n!==void 0?n:S(s.updates.length?s.updates[0].startState:this.view.state));for(let r of s.updates)l=l.update(r,e);if(l.hasResult()){t.push(l);continue}}let i=this.view.state.field(m).active.find(l=>l.source==s.active.source);if(i&&i.state==1)if(s.done==null){let l=new y(s.active.source,0);for(let r of s.updates)l=l.update(r,e);l.state!=1&&t.push(l)}else this.startQuery(i)}t.length&&this.view.dispatch({effects:It.of(t)})}},{eventHandlers:{blur(n){let t=this.view.state.field(m,!1);if(t&&t.tooltip&&this.view.state.facet(v).closeOnBlur){let e=t.open&&ht(this.view,t.open.tooltip);(!e||!e.dom.contains(n.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:F.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:V.of(!1)}),20),this.composing=0}}}),Se=typeof navigator=="object"&&/Win/.test(navigator.platform),Te=Y.highest(E.domEventHandlers({keydown(n,t){let e=t.state.field(m,!1);if(!e||!e.open||e.open.disabled||e.open.selected<0||n.key.length>1||n.ctrlKey&&!(Se&&n.altKey)||n.metaKey)return!1;let o=e.open.options[e.open.selected],s=e.active.find(l=>l.source==o.source),i=o.completion.commitCharacters||s.result.commitCharacters;return i&&i.indexOf(n.key)>-1&&nt(t,o),!1}})),Tt=E.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class Ae{constructor(t,e,o,s){this.field=t,this.line=e,this.from=o,this.to=s}}class rt{constructor(t,e,o){this.field=t,this.from=e,this.to=o}map(t){let e=t.mapPos(this.from,-1,G.TrackDel),o=t.mapPos(this.to,1,G.TrackDel);return e==null||o==null?null:new rt(this.field,e,o)}}class at{constructor(t,e){this.lines=t,this.fieldPositions=e}instantiate(t,e){let o=[],s=[e],i=t.doc.lineAt(e),l=/^\s*/.exec(i.text)[0];for(let a of this.lines){if(o.length){let c=l,p=/^\t*/.exec(a)[0].length;for(let h=0;h<p;h++)c+=t.facet(oe);s.push(e+c.length-p),a=c+a.slice(p)}o.push(a),e+=a.length+1}let r=this.fieldPositions.map(a=>new rt(a.field,s[a.line]+a.from,s[a.line]+a.to));return{text:o,ranges:r}}static parse(t){let e=[],o=[],s=[],i;for(let l of t.split(/\r\n?|\n/)){for(;i=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(l);){let r=i[1]?+i[1]:null,a=i[2]||i[3]||"",c=-1,p=a.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<e.length;h++)(r!=null?e[h].seq==r:p&&e[h].name==p)&&(c=h);if(c<0){let h=0;for(;h<e.length&&(r==null||e[h].seq!=null&&e[h].seq<r);)h++;e.splice(h,0,{seq:r,name:p}),c=h;for(let f of s)f.field>=c&&f.field++}s.push(new Ae(c,o.length,i.index,i.index+p.length)),l=l.slice(0,i.index)+a+l.slice(i.index+i[0].length)}l=l.replace(/\\([{}])/g,(r,a,c)=>{for(let p of s)p.line==o.length&&p.from>c&&(p.from--,p.to--);return a}),o.push(l)}return new at(o,s)}}let De=U.widget({widget:new class extends ne{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),Ee=U.mark({class:"cm-snippetField"});class R{constructor(t,e){this.ranges=t,this.active=e,this.deco=U.set(t.map(o=>(o.from==o.to?De:Ee).range(o.from,o.to)))}map(t){let e=[];for(let o of this.ranges){let s=o.map(t);if(!s)return null;e.push(s)}return new R(e,this.active)}selectionInsideField(t){return t.ranges.every(e=>this.ranges.some(o=>o.field==this.active&&o.from<=e.from&&o.to>=e.to))}}const N=k.define({map(n,t){return n&&n.map(t)}}),Pe=k.define(),T=X.define({create(){return null},update(n,t){for(let e of t.effects){if(e.is(N))return e.value;if(e.is(Pe)&&n)return new R(n.ranges,e.value)}return n&&t.docChanged&&(n=n.map(t.changes)),n&&t.selection&&!n.selectionInsideField(t.selection)&&(n=null),n},provide:n=>E.decorations.from(n,t=>t?t.deco:U.none)});function ot(n,t){return x.create(n.filter(e=>e.field==t).map(e=>x.range(e.from,e.to)))}function At(n){let t=at.parse(n);return(e,o,s,i)=>{let{text:l,ranges:r}=t.instantiate(e.state,s),a={changes:{from:s,to:i,insert:Jt.of(l)},scrollIntoView:!0,annotations:o?[q.of(o),Zt.userEvent.of("input.complete")]:void 0};if(r.length&&(a.selection=ot(r,0)),r.some(c=>c.field>0)){let c=new R(r,0),p=a.effects=[N.of(c)];e.state.field(T,!1)===void 0&&p.push(k.appendConfig.of([T,Me,$e,Tt]))}e.dispatch(e.state.update(a))}}function Dt(n){return({state:t,dispatch:e})=>{let o=t.field(T,!1);if(!o||n<0&&o.active==0)return!1;let s=o.active+n,i=n>0&&!o.ranges.some(l=>l.field==s+n);return e(t.update({selection:ot(o.ranges,s),effects:N.of(i?null:new R(o.ranges,s)),scrollIntoView:!0})),!0}}const Et=({state:n,dispatch:t})=>n.field(T,!1)?(t(n.update({effects:N.of(null)})),!0):!1,Pt=Dt(1),Rt=Dt(-1);function Re(n){let t=n.field(T,!1);return!!(t&&t.ranges.some(e=>e.field==t.active+1))}function Le(n){let t=n.field(T,!1);return!!(t&&t.active>0)}const Be=[{key:"Tab",run:Pt,shift:Rt},{key:"Escape",run:Et}],st=ct.define({combine(n){return n.length?n[0]:Be}}),Me=Y.highest(ft.compute([st],n=>n.facet(st)));function Fe(n,t){return Object.assign(Object.assign({},t),{apply:At(n)})}const $e=E.domEventHandlers({mousedown(n,t){let e=t.state.field(T,!1),o;if(!e||(o=t.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let s=e.ranges.find(i=>i.from<=o&&i.to>=o);return!s||s.field==e.active?!1:(t.dispatch({selection:ot(e.ranges,s.field),effects:N.of(e.ranges.some(i=>i.field>s.field)?new R(e.ranges,s.field):null),scrollIntoView:!0}),!0)}});function Ne(n){let t=n.replace(/[\]\-\\]/g,"\\$&");try{return new RegExp(`[\\p{Alphabetic}\\p{Number}_${t}]+`,"ug")}catch{return new RegExp(`[w${t}]`,"g")}}function Lt(n,t){return new RegExp(t(n.source),n.unicode?"u":"")}const Bt=Object.create(null);function je(n){return Bt[n]||(Bt[n]=new WeakMap)}function Mt(n,t,e,o,s){for(let i=n.iterLines(),l=0;!i.next().done;){let{value:r}=i,a;for(t.lastIndex=0;a=t.exec(r);)if(!o[a[0]]&&l+a.index!=s&&(e.push({type:"text",label:a[0]}),o[a[0]]=!0,e.length>=2e3))return;l+=r.length+1}}function Ft(n,t,e,o,s){let i=n.length>=1e3,l=i&&t.get(n);if(l)return l;let r=[],a=Object.create(null);if(n.children){let c=0;for(let p of n.children){if(p.length>=1e3)for(let h of Ft(p,t,e,o-c,s-c))a[h.label]||(a[h.label]=!0,r.push(h));else Mt(p,e,r,a,s-c);c+=p.length+1}}else Mt(n,e,r,a,s);return i&&r.length<2e3&&t.set(n,r),r}const We=n=>{let t=n.state.languageDataAt("wordChars",n.pos).join(""),e=Ne(t),o=n.matchBefore(Lt(e,l=>l+"$"));if(!o&&!n.explicit)return null;let s=o?o.from:n.pos,i=Ft(n.state.doc,je(t),e,5e4,s);return{from:s,options:i,validFor:Lt(e,l=>"^"+l)}},j={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},A=k.define({map(n,t){return t.mapPos(n,-1,G.TrackAfter)??void 0}}),it=new class extends Yt{};it.startSide=1,it.endSide=-1;const $t=X.define({create(){return Gt.empty},update(n,t){if(n=n.map(t.changes),t.selection){let e=t.state.doc.lineAt(t.selection.main.head);n=n.update({filter:o=>o>=e.from&&o<=e.to})}for(let e of t.effects)e.is(A)&&(n=n.update({add:[it.range(e.value,e.value+1)]}));return n}});function Ue(){return[Ve,$t]}const lt="()[]{}<>";function Nt(n){for(let t=0;t<lt.length;t+=2)if(lt.charCodeAt(t)==n)return lt.charAt(t+1);return pt(n<128?n:n+1)}function jt(n,t){return n.languageDataAt("closeBrackets",t)[0]||j}const qe=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Ve=E.inputHandler.of((n,t,e,o)=>{if((qe?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let s=n.state.selection.main;if(o.length>2||o.length==2&&O(C(o,0))==1||t!=s.from||e!=s.to)return!1;let i=Ut(n.state,o);return i?(n.dispatch(i),!0):!1}),Wt=({state:n,dispatch:t})=>{if(n.readOnly)return!1;let e=jt(n,n.selection.main.head).brackets||j.brackets,o=null,s=n.changeByRange(i=>{if(i.empty){let l=Ke(n.doc,i.head);for(let r of e)if(r==l&&H(n.doc,i.head)==Nt(C(r,0)))return{changes:{from:i.head-r.length,to:i.head+r.length},range:x.cursor(i.head-r.length)}}return{range:o=i}});return o||t(n.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!o},He=[{key:"Backspace",run:Wt}];function Ut(n,t){let e=jt(n,n.selection.main.head),o=e.brackets||j.brackets;for(let s of o){let i=Nt(C(s,0));if(t==s)return i==s?Xe(n,s,o.indexOf(s+s+s)>-1,e):ze(n,s,i,e.before||j.before);if(t==i&&qt(n,n.selection.main.from))return Qe(n,s,i)}return null}function qt(n,t){let e=!1;return n.field($t).between(0,n.doc.length,o=>{o==t&&(e=!0)}),e}function H(n,t){let e=n.sliceString(t,t+2);return e.slice(0,O(C(e,0)))}function Ke(n,t){let e=n.sliceString(t-2,t);return O(C(e,0))==e.length?e:e.slice(1)}function ze(n,t,e,o){let s=null,i=n.changeByRange(l=>{if(!l.empty)return{changes:[{insert:t,from:l.from},{insert:e,from:l.to}],effects:A.of(l.to+t.length),range:x.range(l.anchor+t.length,l.head+t.length)};let r=H(n.doc,l.head);return!r||/\s/.test(r)||o.indexOf(r)>-1?{changes:{insert:t+e,from:l.head},effects:A.of(l.head+t.length),range:x.cursor(l.head+t.length)}:{range:s=l}});return s?null:n.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function Qe(n,t,e){let o=null,s=n.changeByRange(i=>i.empty&&H(n.doc,i.head)==e?{changes:{from:i.head,to:i.head+e.length,insert:e},range:x.cursor(i.head+e.length)}:o={range:i});return o?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Xe(n,t,e,o){let s=o.stringPrefixes||j.stringPrefixes,i=null,l=n.changeByRange(r=>{if(!r.empty)return{changes:[{insert:t,from:r.from},{insert:t,from:r.to}],effects:A.of(r.to+t.length),range:x.range(r.anchor+t.length,r.head+t.length)};let a=r.head,c=H(n.doc,a),p;if(c==t){if(Vt(n,a))return{changes:{insert:t+t,from:a},effects:A.of(a+t.length),range:x.cursor(a+t.length)};if(qt(n,a)){let h=e&&n.sliceDoc(a,a+t.length*3)==t+t+t?t+t+t:t;return{changes:{from:a,to:a+h.length,insert:h},range:x.cursor(a+h.length)}}}else{if(e&&n.sliceDoc(a-2*t.length,a)==t+t&&(p=Ht(n,a-2*t.length,s))>-1&&Vt(n,p))return{changes:{insert:t+t+t+t,from:a},effects:A.of(a+t.length),range:x.cursor(a+t.length)};if(n.charCategorizer(a)(c)!=J.Word&&Ht(n,a,s)>-1&&!Ye(n,a,t,s))return{changes:{insert:t+t,from:a},effects:A.of(a+t.length),range:x.cursor(a+t.length)}}return{range:i=r}});return i?null:n.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function Vt(n,t){let e=M(n).resolveInner(t+1);return e.parent&&e.from==t}function Ye(n,t,e,o){let s=M(n).resolveInner(t,-1),i=o.reduce((l,r)=>Math.max(l,r.length),0);for(let l=0;l<5;l++){let r=n.sliceDoc(s.from,Math.min(s.to,s.from+e.length+i)),a=r.indexOf(e);if(!a||a>-1&&o.indexOf(r.slice(0,a))>-1){let p=s.firstChild;for(;p&&p.from==s.from&&p.to-p.from>e.length+a;){if(n.sliceDoc(p.to-e.length,p.to)==e)return!1;p=p.firstChild}return!0}let c=s.to==t&&s.parent;if(!c)break;s=c}return!1}function Ht(n,t,e){let o=n.charCategorizer(t);if(o(n.sliceDoc(t-1,t))!=J.Word)return t;for(let s of e){let i=t-s.length;if(n.sliceDoc(i,t)==s&&o(n.sliceDoc(i-1,i))!=J.Word)return i}return-1}function Ge(n={}){return[Te,m,v.of(n),Oe,Je,Tt]}const Kt=[{key:"Ctrl-Space",run:Ot},{key:"Escape",run:St},{key:"ArrowDown",run:$(!0)},{key:"ArrowUp",run:$(!1)},{key:"PageDown",run:$(!0,"page")},{key:"PageUp",run:$(!1,"page")},{key:"Enter",run:kt}],Je=Y.highest(ft.computeN([v],n=>n.facet(v).defaultKeymap?[Kt]:[]));function Ze(n){let t=n.field(m,!1);return t&&t.active.some(e=>e.state==1)?"pending":t&&t.active.some(e=>e.state!=0)?"active":null}const zt=new WeakMap;function _e(n){var t;let e=(t=n.field(m,!1))===null||t===void 0?void 0:t.open;if(!e||e.disabled)return[];let o=zt.get(e.options);return o||zt.set(e.options,o=e.options.map(s=>s.completion)),o}function tn(n){var t;let e=(t=n.field(m,!1))===null||t===void 0?void 0:t.open;return e&&!e.disabled&&e.selected>=0?e.options[e.selected].completion:null}function en(n){var t;let e=(t=n.field(m,!1))===null||t===void 0?void 0:t.open;return e&&!e.disabled&&e.selected>=0?e.selected:null}function nn(n){return et.of(n)}export{_ as CompletionContext,kt as acceptCompletion,Ge as autocompletion,Et as clearSnippet,Ue as closeBrackets,He as closeBracketsKeymap,St as closeCompletion,We as completeAnyWord,dt as completeFromList,Kt as completionKeymap,Ze as completionStatus,_e as currentCompletions,Wt as deleteBracketPair,Re as hasNextSnippetField,Le as hasPrevSnippetField,ie as ifIn,le as ifNotIn,Ut as insertBracket,vt as insertCompletionText,$ as moveCompletionSelection,Pt as nextSnippetField,q as pickedCompletion,Rt as prevSnippetField,tn as selectedCompletion,en as selectedCompletionIndex,nn as setSelectedCompletion,At as snippet,Fe as snippetCompletion,st as snippetKeymap,Ot as startCompletion};
