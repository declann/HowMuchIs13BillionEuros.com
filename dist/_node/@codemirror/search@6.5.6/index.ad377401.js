import{showPanel as te,EditorView as x,Decoration as f,ViewPlugin as re,runScopeHandlers as we,getPanel as F}from"../view@6.33.0/index.836a6482.js";import{StateEffect as q,StateField as ie,Facet as se,combineConfig as ne,RangeSetBuilder as Se,Prec as Me,codePointAt as ke,fromCodePoint as Ce,codePointSize as qe,EditorSelection as p,CharCategory as m,EditorState as Le,findClusterBreak as oe}from"../state@6.4.1/index.66d24d9c.js";import h from"../../crelt@1.0.6/index.8ff6b95c.js";const ae=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class y{constructor(e,r,i=0,s=e.length,n,a){this.test=a,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,s),this.bufferStart=i,this.normalize=n?o=>n(ae(o)):ae,this.query=this.normalize(r)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return ke(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let r=Ce(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=qe(e);let s=this.normalize(r);for(let n=0,a=i;;n++){let o=s.charCodeAt(n),l=this.match(o,a,this.bufferPos+this.bufferStart);if(n==s.length-1){if(l)return this.value=l,this;break}a==i&&n<r.length&&r.charCodeAt(n)==o&&a++}}}match(e,r,i){let s=null;for(let n=0;n<this.matches.length;n+=2){let a=this.matches[n],o=!1;this.query.charCodeAt(a)==e&&(a==this.query.length-1?s={from:this.matches[n+1],to:i}:(this.matches[n]++,o=!0)),o||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:r,to:i}:this.matches.push(1,r)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferStart)&&(s=null),s}}typeof Symbol<"u"&&(y.prototype[Symbol.iterator]=function(){return this});const le={from:-1,to:-1,match:/.*/.exec("")},Q="gm"+(/x/.unicode==null?"":"u");class V{constructor(e,r,i,s=0,n=e.length){if(this.text=e,this.to=n,this.curLine="",this.done=!1,this.value=le,/\\[sWDnr]|\n|\r|\[\^/.test(r))return new ce(e,r,i,s,n);this.re=new RegExp(r,Q+(i?.ignoreCase?"i":"")),this.test=i?.test,this.iter=e.iter();let a=e.lineAt(s);this.curLineStart=a.from,this.matchPos=P(e,s),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let r=this.matchPos<=this.to&&this.re.exec(this.curLine);if(r){let i=this.curLineStart+r.index,s=i+r[0].length;if(this.matchPos=P(this.text,s+(i==s?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<s||i>this.value.to)&&(!this.test||this.test(i,s,r)))return this.value={from:i,to:s,match:r},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const N=new WeakMap;class k{constructor(e,r){this.from=e,this.text=r}get to(){return this.from+this.text.length}static get(e,r,i){let s=N.get(e);if(!s||s.from>=i||s.to<=r){let o=new k(r,e.sliceString(r,i));return N.set(e,o),o}if(s.from==r&&s.to==i)return s;let{text:n,from:a}=s;return a>r&&(n=e.sliceString(r,a)+n,a=r),s.to<i&&(n+=e.sliceString(s.to,i)),N.set(e,new k(a,n)),new k(r,n.slice(r-a,i-a))}}class ce{constructor(e,r,i,s,n){this.text=e,this.to=n,this.done=!1,this.value=le,this.matchPos=P(e,s),this.re=new RegExp(r,Q+(i?.ignoreCase?"i":"")),this.test=i?.test,this.flat=k.get(e,s,this.chunkEnd(s+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,r=this.re.exec(this.flat.text);if(r&&!r[0]&&r.index==e&&(this.re.lastIndex=e+1,r=this.re.exec(this.flat.text)),r){let i=this.flat.from+r.index,s=i+r[0].length;if((this.flat.to>=this.to||r.index+r[0].length<=this.flat.text.length-10)&&(!this.test||this.test(i,s,r)))return this.value={from:i,to:s,match:r},this.matchPos=P(this.text,s+(i==s?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=k.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(V.prototype[Symbol.iterator]=ce.prototype[Symbol.iterator]=function(){return this});function We(t){try{return new RegExp(t,Q),!0}catch{return!1}}function P(t,e){if(e>=t.length)return e;let r=t.lineAt(e),i;for(;e<r.to&&(i=r.text.charCodeAt(e-r.from))>=56320&&i<57344;)e++;return e}function B(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),r=h("input",{class:"cm-textfield",name:"line",value:e}),i=h("form",{class:"cm-gotoLine",onkeydown:n=>{n.keyCode==27?(n.preventDefault(),t.dispatch({effects:R.of(!1)}),t.focus()):n.keyCode==13&&(n.preventDefault(),s())},onsubmit:n=>{n.preventDefault(),s()}},h("label",t.state.phrase("Go to line"),": ",r)," ",h("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function s(){let n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(r.value);if(!n)return;let{state:a}=t,o=a.doc.lineAt(a.selection.main.head),[,l,c,u,v]=n,D=u?+u.slice(1):0,C=c?+c:o.number;if(c&&v){let T=C/100;l&&(T=T*(l=="-"?-1:1)+o.number/a.doc.lines),C=Math.round(a.doc.lines*T)}else c&&l&&(C=C*(l=="-"?-1:1)+o.number);let _=a.doc.line(Math.max(1,Math.min(a.doc.lines,C))),ee=p.cursor(_.from+Math.max(0,Math.min(D,_.length)));t.dispatch({effects:[R.of(!1),x.scrollIntoView(ee.from,{y:"center"})],selection:ee}),t.focus()}return{dom:i}}const R=q.define(),he=ie.define({create(){return!0},update(t,e){for(let r of e.effects)r.is(R)&&(t=r.value);return t},provide:t=>te.from(t,e=>e?B:null)}),ue=t=>{let e=F(t,B);if(!e){let r=[R.of(!0)];t.state.field(he,!1)==null&&r.push(q.appendConfig.of([he,Ae])),t.dispatch({effects:r}),e=F(t,B)}return e&&e.dom.querySelector("input").select(),!0},Ae=x.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),De={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},fe=se.define({combine(t){return ne(t,De,{highlightWordAroundCursor:(e,r)=>e||r,minSelectionLength:Math.min,maxMatches:Math.min})}});function Fe(t){let e=[ze,Ie];return t&&e.push(fe.of(t)),e}const Pe=f.mark({class:"cm-selectionMatch"}),Re=f.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function de(t,e,r,i){return(r==0||t(e.sliceDoc(r-1,r))!=m.Word)&&(i==e.doc.length||t(e.sliceDoc(i,i+1))!=m.Word)}function Ee(t,e,r,i){return t(e.sliceDoc(r,r+1))==m.Word&&t(e.sliceDoc(i-1,i))==m.Word}const Ie=re.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(fe),{state:r}=t,i=r.selection;if(i.ranges.length>1)return f.none;let s=i.main,n,a=null;if(s.empty){if(!e.highlightWordAroundCursor)return f.none;let l=r.wordAt(s.head);if(!l)return f.none;a=r.charCategorizer(s.head),n=r.sliceDoc(l.from,l.to)}else{let l=s.to-s.from;if(l<e.minSelectionLength||l>200)return f.none;if(e.wholeWords){if(n=r.sliceDoc(s.from,s.to),a=r.charCategorizer(s.head),!(de(a,r,s.from,s.to)&&Ee(a,r,s.from,s.to)))return f.none}else if(n=r.sliceDoc(s.from,s.to),!n)return f.none}let o=[];for(let l of t.visibleRanges){let c=new y(r.doc,n,l.from,l.to);for(;!c.next().done;){let{from:u,to:v}=c.value;if((!a||de(a,r,u,v))&&(s.empty&&u<=s.from&&v>=s.to?o.push(Re.range(u,v)):(u>=s.to||v<=s.from)&&o.push(Pe.range(u,v)),o.length>e.maxMatches))return f.none}}return f.set(o)}},{decorations:t=>t.decorations}),ze=x.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),$e=({state:t,dispatch:e})=>{let{selection:r}=t,i=p.create(r.ranges.map(s=>t.wordAt(s.head)||p.cursor(s.head)),r.mainIndex);return i.eq(r)?!1:(e(t.update({selection:i})),!0)};function Oe(t,e){let{main:r,ranges:i}=t.selection,s=t.wordAt(r.head),n=s&&s.from==r.from&&s.to==r.to;for(let a=!1,o=new y(t.doc,e,i[i.length-1].to);;)if(o.next(),o.done){if(a)return null;o=new y(t.doc,e,0,Math.max(0,i[i.length-1].from-1)),a=!0}else{if(a&&i.some(l=>l.from==o.value.from))continue;if(n){let l=t.wordAt(o.value.from);if(!l||l.from!=o.value.from||l.to!=o.value.to)continue}return o.value}}const me=({state:t,dispatch:e})=>{let{ranges:r}=t.selection;if(r.some(n=>n.from===n.to))return $e({state:t,dispatch:e});let i=t.sliceDoc(r[0].from,r[0].to);if(t.selection.ranges.some(n=>t.sliceDoc(n.from,n.to)!=i))return!1;let s=Oe(t,i);return s?(e(t.update({selection:t.selection.addRange(p.range(s.from,s.to),!1),effects:x.scrollIntoView(s.to)})),!0):!1},b=se.define({combine(t){return ne(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Xe(e),scrollToMatch:e=>x.scrollIntoView(e)})}});function Te(t){return t?[b.of(t),Z]:Z}class K{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||We(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(r,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Be(this):new Ve(this)}getCursor(e,r=0,i){let s=e.doc?e:Le.create({doc:e});return i==null&&(i=s.doc.length),this.regexp?S(this,s,r,i):w(this,s,r,i)}}class pe{constructor(e){this.spec=e}}function w(t,e,r,i){return new y(e.doc,t.unquoted,r,i,t.caseSensitive?void 0:s=>s.toLowerCase(),t.wholeWord?Qe(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Qe(t,e){return(r,i,s,n)=>((n>r||n+s.length<i)&&(n=Math.max(0,r-2),s=t.sliceString(n,Math.min(t.length,i+2))),(e(E(s,r-n))!=m.Word||e(I(s,r-n))!=m.Word)&&(e(I(s,i-n))!=m.Word||e(E(s,i-n))!=m.Word))}class Ve extends pe{constructor(e){super(e)}nextMatch(e,r,i){let s=w(this.spec,e,i,e.doc.length).nextOverlapping();return s.done&&(s=w(this.spec,e,0,r).nextOverlapping()),s.done?null:s.value}prevMatchInRange(e,r,i){for(let s=i;;){let n=Math.max(r,s-1e4-this.spec.unquoted.length),a=w(this.spec,e,n,s),o=null;for(;!a.nextOverlapping().done;)o=a.value;if(o)return o;if(n==r)return null;s-=1e4}}prevMatch(e,r,i){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,r){let i=w(this.spec,e,0,e.doc.length),s=[];for(;!i.next().done;){if(s.length>=r)return null;s.push(i.value)}return s}highlight(e,r,i,s){let n=w(this.spec,e,Math.max(0,r-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}function S(t,e,r,i){return new V(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Ne(e.charCategorizer(e.selection.main.head)):void 0},r,i)}function E(t,e){return t.slice(oe(t,e,!1),e)}function I(t,e){return t.slice(e,oe(t,e))}function Ne(t){return(e,r,i)=>!i[0].length||(t(E(i.input,i.index))!=m.Word||t(I(i.input,i.index))!=m.Word)&&(t(I(i.input,i.index+i[0].length))!=m.Word||t(E(i.input,i.index+i[0].length))!=m.Word)}class Be extends pe{nextMatch(e,r,i){let s=S(this.spec,e,i,e.doc.length).next();return s.done&&(s=S(this.spec,e,0,r).next()),s.done?null:s.value}prevMatchInRange(e,r,i){for(let s=1;;s++){let n=Math.max(r,i-s*1e4),a=S(this.spec,e,n,i),o=null;for(;!a.next().done;)o=a.value;if(o&&(n==r||o.from>n+10))return o;if(n==r)return null}}prevMatch(e,r,i){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(r,i)=>i=="$"?"$":i=="&"?e.match[0]:i!="0"&&+i<e.match.length?e.match[i]:r)}matchAll(e,r){let i=S(this.spec,e,0,e.doc.length),s=[];for(;!i.next().done;){if(s.length>=r)return null;s.push(i.value)}return s}highlight(e,r,i,s){let n=S(this.spec,e,Math.max(0,r-250),Math.min(i+250,e.doc.length));for(;!n.next().done;)s(n.value.from,n.value.to)}}const M=q.define(),G=q.define(),g=ie.define({create(t){return new H(z(t).create(),null)},update(t,e){for(let r of e.effects)r.is(M)?t=new H(r.value.create(),t.panel):r.is(G)&&(t=new H(t.query,r.value?J:null));return t},provide:t=>te.from(t,e=>e.panel)});function Ke(t){let e=t.field(g,!1);return e?e.query.spec:z(t)}function Ge(t){var e;return((e=t.field(g,!1))===null||e===void 0?void 0:e.panel)!=null}class H{constructor(e,r){this.query=e,this.panel=r}}const He=f.mark({class:"cm-searchMatch"}),je=f.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Je=re.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(g))}update(t){let e=t.state.field(g);(e!=t.startState.field(g)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return f.none;let{view:r}=this,i=new Se;for(let s=0,n=r.visibleRanges,a=n.length;s<a;s++){let{from:o,to:l}=n[s];for(;s<a-1&&l>n[s+1].from-2*250;)l=n[++s].to;t.highlight(r.state,o,l,(c,u)=>{let v=r.state.selection.ranges.some(D=>D.from==c&&D.to==u);i.add(c,u,v?je:He)})}return i.finish()}},{decorations:t=>t.decorations});function L(t){return e=>{let r=e.state.field(g,!1);return r&&r.query.spec.valid?t(e,r):U(e)}}const W=L((t,{query:e})=>{let{to:r}=t.state.selection.main,i=e.nextMatch(t.state,r,r);if(!i)return!1;let s=p.single(i.from,i.to),n=t.state.facet(b);return t.dispatch({selection:s,effects:[Y(t,i),n.scrollToMatch(s.main,t)],userEvent:"select.search"}),be(t),!0}),A=L((t,{query:e})=>{let{state:r}=t,{from:i}=r.selection.main,s=e.prevMatch(r,i,i);if(!s)return!1;let n=p.single(s.from,s.to),a=t.state.facet(b);return t.dispatch({selection:n,effects:[Y(t,s),a.scrollToMatch(n.main,t)],userEvent:"select.search"}),be(t),!0}),ge=L((t,{query:e})=>{let r=e.matchAll(t.state,1e3);return!r||!r.length?!1:(t.dispatch({selection:p.create(r.map(i=>p.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),ve=({state:t,dispatch:e})=>{let r=t.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:i,to:s}=r.main,n=[],a=0;for(let o=new y(t.doc,t.sliceDoc(i,s));!o.next().done;){if(n.length>1e3)return!1;o.value.from==i&&(a=n.length),n.push(p.range(o.value.from,o.value.to))}return e(t.update({selection:p.create(n,a),userEvent:"select.search.matches"})),!0},j=L((t,{query:e})=>{let{state:r}=t,{from:i,to:s}=r.selection.main;if(r.readOnly)return!1;let n=e.nextMatch(r,i,i);if(!n)return!1;let a=[],o,l,c=[];if(n.from==i&&n.to==s&&(l=r.toText(e.getReplacement(n)),a.push({from:n.from,to:n.to,insert:l}),n=e.nextMatch(r,n.from,n.to),c.push(x.announce.of(r.phrase("replaced match on line $",r.doc.lineAt(i).number)+"."))),n){let u=a.length==0||a[0].from>=n.to?0:n.to-n.from-l.length;o=p.single(n.from-u,n.to-u),c.push(Y(t,n)),c.push(r.facet(b).scrollToMatch(o.main,t))}return t.dispatch({changes:a,selection:o,effects:c,userEvent:"input.replace"}),!0}),xe=L((t,{query:e})=>{if(t.state.readOnly)return!1;let r=e.matchAll(t.state,1e9).map(s=>{let{from:n,to:a}=s;return{from:n,to:a,insert:e.getReplacement(s)}});if(!r.length)return!1;let i=t.state.phrase("replaced $ matches",r.length)+".";return t.dispatch({changes:r,effects:x.announce.of(i),userEvent:"input.replace.all"}),!0});function J(t){return t.state.facet(b).createPanel(t)}function z(t,e){var r,i,s,n,a;let o=t.selection.main,l=o.empty||o.to>o.from+100?"":t.sliceDoc(o.from,o.to);if(e&&!l)return e;let c=t.facet(b);return new K({search:((r=e?.literal)!==null&&r!==void 0?r:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(i=e?.caseSensitive)!==null&&i!==void 0?i:c.caseSensitive,literal:(s=e?.literal)!==null&&s!==void 0?s:c.literal,regexp:(n=e?.regexp)!==null&&n!==void 0?n:c.regexp,wholeWord:(a=e?.wholeWord)!==null&&a!==void 0?a:c.wholeWord})}function ye(t){let e=F(t,J);return e&&e.dom.querySelector("[main-field]")}function be(t){let e=ye(t);e&&e==t.root.activeElement&&e.select()}const U=t=>{let e=t.state.field(g,!1);if(e&&e.panel){let r=ye(t);if(r&&r!=t.root.activeElement){let i=z(t.state,e.query.spec);i.valid&&t.dispatch({effects:M.of(i)}),r.focus(),r.select()}}else t.dispatch({effects:[G.of(!0),e?M.of(z(t.state,e.query.spec)):q.appendConfig.of(Z)]});return!0},X=t=>{let e=t.state.field(g,!1);if(!e||!e.panel)return!1;let r=F(t,J);return r&&r.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:G.of(!1)}),!0},Ue=[{key:"Mod-f",run:U,scope:"editor search-panel"},{key:"F3",run:W,shift:A,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:W,shift:A,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:X,scope:"editor search-panel"},{key:"Mod-Shift-l",run:ve},{key:"Mod-Alt-g",run:ue},{key:"Mod-d",run:me,preventDefault:!0}];class Xe{constructor(e){this.view=e;let r=this.query=e.state.field(g).query.spec;this.commit=this.commit.bind(this),this.searchField=h("input",{value:r.search,placeholder:d(e,"Find"),"aria-label":d(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=h("input",{value:r.replace,placeholder:d(e,"Replace"),"aria-label":d(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=h("input",{type:"checkbox",name:"case",form:"",checked:r.caseSensitive,onchange:this.commit}),this.reField=h("input",{type:"checkbox",name:"re",form:"",checked:r.regexp,onchange:this.commit}),this.wordField=h("input",{type:"checkbox",name:"word",form:"",checked:r.wholeWord,onchange:this.commit});function i(s,n,a){return h("button",{class:"cm-button",name:s,onclick:n,type:"button"},a)}this.dom=h("div",{onkeydown:s=>this.keydown(s),class:"cm-search"},[this.searchField,i("next",()=>W(e),[d(e,"next")]),i("prev",()=>A(e),[d(e,"previous")]),i("select",()=>ge(e),[d(e,"all")]),h("label",null,[this.caseField,d(e,"match case")]),h("label",null,[this.reField,d(e,"regexp")]),h("label",null,[this.wordField,d(e,"by word")]),...e.state.readOnly?[]:[h("br"),this.replaceField,i("replace",()=>j(e),[d(e,"replace")]),i("replaceAll",()=>xe(e),[d(e,"replace all")])],h("button",{name:"close",onclick:()=>X(e),"aria-label":d(e,"close"),type:"button"},["\xD7"])])}commit(){let e=new K({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:M.of(e)}))}keydown(e){we(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?A:W)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),j(this.view))}update(e){for(let r of e.transactions)for(let i of r.effects)i.is(M)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(b).top}}function d(t,e){return t.state.phrase(e)}const $=30,O=/[\s\.,:;?!]/;function Y(t,{from:e,to:r}){let i=t.state.doc.lineAt(e),s=t.state.doc.lineAt(r).to,n=Math.max(i.from,e-$),a=Math.min(s,r+$),o=t.state.sliceDoc(n,a);if(n!=i.from){for(let l=0;l<$;l++)if(!O.test(o[l+1])&&O.test(o[l])){o=o.slice(l);break}}if(a!=s){for(let l=o.length-1;l>o.length-$;l--)if(!O.test(o[l-1])&&O.test(o[l])){o=o.slice(0,l);break}}return x.announce.of(`${t.state.phrase("current match")}. ${o} ${t.state.phrase("on line")} ${i.number}.`)}const Ye=x.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Z=[g,Me.low(Je),Ye];export{V as RegExpCursor,y as SearchCursor,K as SearchQuery,X as closeSearchPanel,W as findNext,A as findPrevious,Ke as getSearchQuery,ue as gotoLine,Fe as highlightSelectionMatches,U as openSearchPanel,xe as replaceAll,j as replaceNext,Te as search,Ue as searchKeymap,Ge as searchPanelOpen,ge as selectMatches,me as selectNextOccurrence,ve as selectSelectionMatches,M as setSearchQuery};
